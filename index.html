<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>AI Diet Planner</title>
  <style>
    body {margin:0; font-family:system-ui; background:#0b0c10; color:#e6e7eb;}
    .app {max-width:900px; margin:40px auto; display:grid; grid-template-columns:1fr 1fr; gap:20px; padding:0 20px;}
    .card {background:#111319; border-radius:18px; padding:20px; box-shadow:0 6px 18px rgba(0,0,0,.35);}
    .btn {display:inline-block; padding:12px 18px; border-radius:12px;
          background:linear-gradient(135deg,#6ee7b7,#60a5fa); color:#0b1220;
          font-weight:700; cursor:pointer; border:none;}
    input[type=file]{display:none}
    input[type=number]{
      background: #0b1220;
      border: 1px solid #333;
      color: #e6e7eb;
      border-radius: 8px;
      padding: 8px 12px;
      width: calc(50% - 24px);
      margin-right: 12px;
    }
    .preview img {max-width:100%; border-radius:14px; border:1px solid rgba(255,255,255,.1);}
    .diet {margin-top:12px; line-height:1.5; white-space: pre-wrap;}
    h2 {margin-top:0;}
    #lang-switcher {display:inline-flex; gap:10px; justify-content:center; margin-top:10px;}
    .flag {
      cursor: pointer;
      padding: 6px 10px;
      border-radius: 10px;
      border: 2px solid transparent;
      transition: all 0.3s ease;
      font-size: 24px;
    }
    .flag:hover {transform: scale(1.2);}
    .flag.active {border-color: #60a5fa; background: rgba(96,165,250,0.2);}
    #bmi-inputs {margin-top: 15px;}
    .alert {color: #f44336; margin-top: 10px;}
 </style>
</head>
<body>
  <header style="text-align:center; margin:20px;">
    <h1 id="title">AI Diet Planner (online)</h1>
    <p id="subtitle">Загрузи фото — получи готовую диету</p>
    <div id="lang-switcher">
      <div class="flag" data-lang="ru">🇷🇺</div>
      <div class="flag" data-lang="en">🇺🇸</div>
    </div>
  </header>

  <main class="app">
        <section class="card">
      <h2 id="uploadTitle">Загрузка фото</h2>
      <label class="btn" for="file" id="uploadBtn">Выбрать фото</label>
      <input type="file" id="file" accept="image/*">
      <div class="preview" style="margin-top:16px">
        <img id="img" hidden>
      </div>
     <div id="bmi-inputs">
        <h3 id="bmiTitle">Или введи данные для расчета ИМТ</h3>
        <input type="number" id="height" placeholder="Рост, см">
        <input type="number" id="weight" placeholder="Вес, кг">
     </div>
      <button class="btn" id="analyze" style="margin-top:16px;">Назначить диету</button>
      <div id="alert-message" class="alert"></div>
    </section>

        <section class="card">
      <h2 id="resultTitle">Твоя диета</h2>
      <div id="result" class="diet">Здесь появится план питания</div>
    </section>
  </main>

  <script>
    const fileInput = document.getElementById('file');
    const img = document.getElementById('img');
    const analyzeBtn = document.getElementById('analyze');
    const resultEl = document.getElementById('result');
    const flags = document.querySelectorAll('.flag');
    const heightInput = document.getElementById('height');
    const weightInput = document.getElementById('weight');
    const alertMessageEl = document.getElementById('alert-message');

    let currentLang = "ru";

    const diets = {
        ru: [
            { id: 'weightLoss', title: "Похудение", text: "08:00 – Завтрак: овсянка с ягодами и зелёный чай (300 ккал)\n13:00 – Обед: куриная грудка на гриле + овощной салат (450 ккал)\n19:00 – Ужин: салат с тунцом и овощами (350 ккал)\nИтого: около 1100 ккал."},
            { id: 'muscleGain', title: "Набор массы", text: "08:00 – Завтрак: омлет из четырёх яиц и цельнозерновой хлеб, кофе (500 ккал)\n13:30 – Обед: рис, говядина и овощи на пару (700 ккал)\n20:00 – Ужин: паста с курицей и соусом (600 ккал)\nИтого: около 1800 ккал."},
            { id: 'maintainWeight', title: "Поддержание веса", text: "07:30 – Завтрак: йогурт с мюсли и фруктами (350 ккал)\n13:00 – Обед: курица, гречка и овощи (550 ккал)\n19:30 – Ужин: рыба на пару и салат из свежих овощей (450 ккал)\nИтого: около 1350 ккал."},
            { id: 'vegetarian', title: "Вегетарианская диета", text: "08:30 – Завтрак: тост с авокадо и семенами чиа (350 ккал)\n13:00 – Обед: чечевичный суп с цельнозерновым хлебом (400 ккал)\n19:00 – Ужин: салат из киноа с овощами и нутом (450 ккал)\nИтого: около 1200 ккал."},
            { id: 'highProtein', title: "Высокобелковая диета", text: "08:00 – Завтрак: омлет с сыром и шпинатом (400 ккал)\n13:00 – Обед: запеченная куриная грудка с брокколи (500 ккал)\n19:30 – Ужин: нежирный творог с ягодами и орехами (300 ккал)\nИтого: около 1200 ккал."}
        ],
        en: [
            { id: 'weightLoss', title: "Weight Loss", text: "08:00 – Breakfast: oatmeal with berries and green tea (300 kcal)\n13:00 – Lunch: grilled chicken breast with vegetable salad (450 kcal)\n19:00 – Dinner: tuna salad with vegetables (350 kcal)\nTotal: about 1100 kcal."},
            { id: 'muscleGain', title: "Muscle Gain", text: "08:00 – Breakfast: omelet of 4 eggs with whole grain bread, coffee (500 kcal)\n13:30 – Lunch: rice with beef and steamed vegetables (700 kcal)\n20:00 – Dinner: pasta with chicken and sauce (600 kcal)\nTotal: about 1800 kcal."},
            { id: 'maintainWeight', title: "Maintain Weight", text: "07:30 – Breakfast: yogurt with muesli and fruits (350 kcal)\n13:00 – Lunch: chicken, buckwheat and vegetables (550 kcal)\n19:30 – Dinner: steamed fish with fresh vegetable salad (450 kcal)\nTotal: about 1350 kcal."},
            { id: 'vegetarian', title: "Vegetarian Diet", text: "08:30 – Breakfast: avocado toast with chia seeds (350 kcal)\n13:00 – Lunch: lentil soup with whole-grain bread (400 kcal)\n19:00 – Dinner: quinoa salad with vegetables and chickpeas (450 kcal)\nTotal: about 1200 kcal."},
            { id: 'highProtein', title: "High Protein Diet", text: "08:00 – Breakfast: omelet with cheese and spinach (400 kcal)\n13:00 – Lunch: baked chicken breast with broccoli (500 kcal)\n19:30 – Dinner: low-fat cottage cheese with berries and nuts (300 kcal)\nTotal: about 1200 kcal."}
        ]
    };

    const uiText = {
      ru: {title: "AI Diet Planner (online)", subtitle: "Загрузи фото — получи готовую диету", uploadTitle: "Загрузка фото", uploadBtn: "Выбрать фото", analyze: "Назначить диету", resultTitle: "Твоя диета", empty: "Здесь появится план питания", bmiTitle: "Или введи данные для расчета ИМТ", noPhotoAlert: "Пожалуйста, выберите фото!", noResultAlert: "Не удалось определить диету по ИМТ. Попробуйте еще раз."},
      en: {title: "AI Diet Planner (online)", subtitle: "Upload a photo — get your diet plan", uploadTitle: "Upload Photo", uploadBtn: "Choose Photo", analyze: "Generate Diet", resultTitle: "Your Diet", empty: "Your diet plan will appear here", bmiTitle: "Or enter data for BMI calculation", noPhotoAlert: "Please select a photo!", noResultAlert: "Could not determine diet based on BMI. Please try again."}
    };

    fileInput.addEventListener('change', e=>{
      const f = e.target.files[0];
      if(f){ img.src = URL.createObjectURL(f); img.hidden = false; }
    });

    function speak(text, lang) {
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = lang === "ru" ? "ru-RU" : "en-US";
      speechSynthesis.cancel();
      speechSynthesis.speak(utterance);
    }

    function calculateBMI(height, weight) {
        if (!height || !weight) return null;
        const heightM = height / 100;
        return weight / (heightM * heightM);
    }

    function getDietByBMI(bmi) {
        if (bmi === null) return null;
        if (bmi < 18.5) return 'muscleGain';
        if (bmi >= 18.5 && bmi < 25) return 'maintainWeight';
        if (bmi >= 25) return 'weightLoss';
        return null;
    }

    analyzeBtn.addEventListener('click', ()=>{
        alertMessageEl.innerText = "";
        const height = parseFloat(heightInput.value);
        const weight = parseFloat(weightInput.value);
        const bmi = calculateBMI(height, weight);
        let diet = null;

        if (bmi) {
            const dietId = getDietByBMI(bmi);
            diet = diets[currentLang].find(d => d.id === dietId);
        } else {
            // Если ИМТ не посчитан, ищем случайную диету, кроме специализированных
            const generalDiets = diets[currentLang].filter(d => ['weightLoss', 'muscleGain', 'maintainWeight'].includes(d.id));
            diet = generalDiets[Math.floor(Math.random() * generalDiets.length)];
        }

        if (diet) {
            resultEl.innerHTML = `<h3>${diet.title}</h3>${diet.text}`;
            speak(`${diet.title}. ${diet.text}`, currentLang);
        } else {
            resultEl.innerHTML = uiText[currentLang].noResultAlert;
            speak(uiText[currentLang].noResultAlert, currentLang);
        }
    });

    function setLanguage(lang) {
      currentLang = lang;
      const t = uiText[currentLang];
      document.getElementById("title").innerText = t.title;
      document.getElementById("subtitle").innerText = t.subtitle;
      document.getElementById("uploadTitle").innerText = t.uploadTitle;
      document.getElementById("uploadBtn").innerText = t.uploadBtn;
      document.getElementById("analyze").innerText = t.analyze;
      document.getElementById("resultTitle").innerText = t.resultTitle;
      resultEl.innerText = t.empty;
      document.getElementById("bmiTitle").innerText = t.bmiTitle;
      heightInput.placeholder = lang === 'ru' ? "Рост, см" : "Height, cm";
      weightInput.placeholder = lang === 'ru' ? "Вес, кг" : "Weight, kg";
      alertMessageEl.innerText = "";
      flags.forEach(f => f.classList.toggle('active', f.dataset.lang === lang));
    }

    flags.forEach(flag => flag.addEventListener('click', ()=>setLanguage(flag.dataset.lang)));

    // Инициализация
    setLanguage('ru');
  </script>
</body>
</html>
